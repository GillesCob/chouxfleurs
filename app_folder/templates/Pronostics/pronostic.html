{% extends 'base.html' %}

{% block title %}
    Pronostics
{% endblock %}


{% block content %}

{% if session.selected_project.id %}

{% if pronostic_done %}
    <div class="my_container">
            <div class="multiple_btn_container">
                {%if end_pronostics == True%}
                    <form action="{{ url_for('views.pronostic_winner')}}" method="post">
                        <input type="hidden" name="go_to_pronostic" value=false>
                        <button type="submit" class="my_btn white_btn">Le gagnant</button>
                    </form>
                    <button onclick="window.location.href='/pronostic_answers'" class="my_btn white_btn">La r√©ponse</button>
                    <button type="button" id="btn_my_answers" class="my_btn">Mes r√©ponses</button>
                {%else%}
                    <button type="button" id="btn_my_answers" class="my_btn">Mes r√©ponses</button>
                    <button type="button" class="my_btn white_btn" onclick="window.location.href='/all_pronostics'">La tendance</button>
                {%endif%}
            </div>
        </div>
        <div class="my_container">
            <div class="my_card inert_card">
                <!-- Le sexe ----------------------------------------- -->
                <div class = "pronostic_title">
                    <label for="name" >Le sexe</label>
                    <p class="pronostic_answer">{{ prono_sex }}
                    {% if user_is_admin == False %}
                        {%if end_pronostics == True%}
                            : {{ score_prono_user.Sex }}/{{ scores_pronostics['Sex']['good'] }}
                        {%endif%}
                    {%endif%}
                    </p>
                </div>

                <!-- Le nom ----------------------------------------- -->
                <div class = "pronostic_title">
                    <label for="name" >Le pr√©nom</label>
                    <p class="pronostic_answer">{{ prono_name }}
                    {% if user_is_admin == False %}
                        {%if end_pronostics == True%}
                            : {{ score_prono_user.Name }}/{{ scores_pronostics['Name']['good'] }}
                        {%endif%}
                    {%endif%}
                    </p>
                </div>

                <!-- Le poids ----------------------------------------- -->
                <div class = "pronostic_title">
                    <label for="weight" >Le poids</label>
                    <p class="pronostic_answer">{{ prono_weight }} kilogrammes

                    {% if user_is_admin == False %}
                        {%if end_pronostics == True%}
                            : {{ score_prono_user.Weight }}/{{ scores_pronostics['Weight']['good'] }}
                        {%endif%}
                    {%endif%}
                    </p>
                </div>

                <!-- La taille ----------------------------------------- -->
                <div class = "pronostic_title">
                    <label for="height" >La taille</label>
                    <p class="pronostic_answer">{{ prono_height }} centim√®tres

                    {% if user_is_admin == False %}
                        {%if end_pronostics == True%}
                            : {{ score_prono_user.Height }}/{{ scores_pronostics['Height']['good'] }}
                        {%endif%}
                    {%endif%}
                    </p>
                </div>

                <!-- La date ----------------------------------------- -->
                <div class = "pronostic_title">
                    <label for="date" >La date</label>
                    <p class="pronostic_answer">{{ prono_date }}

                    {% if user_is_admin == False %}
                        {%if end_pronostics == True%}
                            : {{ score_prono_user.Date }}/{{ scores_pronostics['Date']['good'] }}
                        {%endif%}
                    {%endif%}
                    </p>
                </div>

                <!-- Score total ----------------------------------------- -->
                <div class = "pronostic_title">
                {% if user_is_admin == False %}
                    {%if end_pronostics == True%}
                        <label for="date" >Score Total</label>
                        <p class="pronostic_answer">{{ score_prono_user.Total }}/{{total_possible}}</p>
                    {%endif%}
                {%endif%}
                </div>
                

                <!-- Changer de pronostic ----------------------------------------- -->
                {%if end_pronostics == False%}
                    <div class="text-center">
                            <button onclick="window.location.href='/update_pronostic'" id="btn_change_prono" class="my_btn validate-btn">Changer de pronostic</button>
                    </div>
                {%endif%}

                {% if user_is_admin%}
                <div class="my_container">
                    <button onclick="window.location.href='/update_pronostic'" id="btn_change_prono" class="my_btn validate-btn">Modifier les r√©ponses</button>
                </div>
                {%endif%}

            </div>
            
        </div>
        
    {% else %}
        {%if end_pronostics == False %}
            <div>
                <div class="my_container">
                    {% if user_is_admin%}
                    <h1>Le b√©b√© est n√©? </br> C'est parti pour les r√©ponses !</h1>

                    {%else%}
                    <h1>A vos pronostics !</h1>
                    {%endif%}
                    <div class="my_card inert_card">
                        <form method="post">
                            <input type="hidden" name="project_id" value="{{ session.selected_project.id }}">
    
                            <!-- Le sexe ----------------------------------------- -->
                            <div class = "pronostic_title ">
                                <label for="name" >Le sexe</label>
                            </div>
                            
                            <div class="two_btn_container">
                                <input type="hidden" id="selectedGender" name="sex">
                                <button type="button" class="my_btn gender_girl" id="btn_girl" onclick="selectGender('Fille')">Fille</button>
                                <button type="button" class="my_btn gender_boy" id="btn_boy" onclick="selectGender('Gar√ßon')">Gar√ßon</button>
                            </div>
                            
                            
                            <!-- Le nom ----------------------------------------- -->
                            <div class = "pronostic_title">
                                <label for="name">Le pr√©nom</label>
                                {%if clue_name != None %}
                                <p class="pronostic_answer">Indice : {{clue_name}}</p>
                                {%endif%}
                                <input type="text" class="form-control text-center" name="name" maxlength="20" required>
                            </div>
                            
    
                            <!-- Le poids ----------------------------------------- -->
                            <div class = "pronostic_title">
                                <label for="weight" >Le poids</label>
                            </div>
                
                            <input type="range" class="form-range" id="weight" name="weight" min="2.5" max="4.5" step="0.01" oninput="updateWeightValue(this.value)">
                            <span id="weightValue">3,50</span> kilos
                
                
                            <!-- La taille ----------------------------------------- -->
                            <div class = "pronostic_title">
                                <label for="height" >La taille</label>
                            </div>
                
                            <input type="range" class="form-range" id="height" name="height" min="30" max="60" step="0.1" oninput="updateHeightValue(this.value)">
                            <span id="heightValue">45</span> Centim√®tres
                
                
                            <!-- La date ----------------------------------------- -->
                            <div class = "pronostic_title">
                                <label for="date" >La date</label>
                                {%if due_date != None %}
                                <p class="pronostic_answer">Date du terme : {{due_date}}</p>
                                {%endif%}
                            </div>
                            
                            <input type="date" class="form-control text-center" name="date" required>
                
                
                            <!-- Validation du pronostic ----------------------------------------- -->
                            {% if user_is_admin %}
                                <!-- <button type="submit" class="my_btn" id="validate_prono">Donner les r√©ponses</button> -->
                                <button type="submit" class="my_btn mb-1" id="validate_prono">Donner les r√©ponses</button>
                                
                                {%if at_least_one_pronostic == True %}
                                <div>
                                    <button type="button" class="my_btn mt-1" onclick="window.location.href='/all_pronostics'">Voir la tendance</button>
                                </div>
                                {%endif%}
                                
    
                            {%else%}
                                <button type="submit" class="my_btn" id="validate_prono">Valider info</button>
                            {%endif%}
                            
                
                        </form>
                    </div>
                    
                </div>
            </div>
        {%else%}
            <div class="my_container">
                <h1>Les r√©ponses ont d√©j√† √©t√© donn√©es, c'est trop tard pour participer üòï</h1>
                <!-- Ajouter ici la carte avec les r√©ponses de l'admin -->
            </div>
        {%endif%}

    {%endif%}
    

{% else %}
Aucun projet s√©lectionn√©.
{% endif %}

    <!-- ===============================================-->
    <!--    JavaScripts-->
    <!-- ===============================================-->
<script>


    document.addEventListener('DOMContentLoaded', function() {
        var btn_the_answers = document.getElementById('btn_my_answers');
        var gender_choice = "{{ prono_sex_btn }}";

        btn_the_answers.classList.remove('gender_girl', 'gender_boy');

        if (gender_choice === "Fille") {
        btn_the_answers.classList.add("gender_girl");
    } else {
        btn_the_answers.classList.add("gender_boy");
    }
    });


    if ("{{ pronostic_done }}" === "True") {

        document.addEventListener('DOMContentLoaded', function() {
        var btn_the_answers = document.getElementById('btn_my_answers');
        var btn_change_prono = document.getElementById('btn_change_prono');
        var gender_choice = "{{ prono_sex_btn }}";


        btn_the_answers.classList.remove('gender_girl', 'gender_boy');
        btn_change_prono.classList.remove('gender_girl', 'gender_boy');

        if (gender_choice === "Fille") {
            btn_the_answers.classList.add("gender_girl");
            btn_change_prono.classList.add("gender_girl");
        } else {
            btn_the_answers.classList.add("gender_boy");
            btn_change_prono.classList.add("gender_boy");
        }

    });

    
    } else {

    // Script pour la partie lorsque le prono n'a pas √©t√© fait
    function updateButtonClass() {
        var btn_girlClicked = document.getElementById('btn_girl').dataset.clicked === 'true';
        var btn_boyClicked = document.getElementById('btn_boy').dataset.clicked === 'true';
        var validate_prono = document.getElementById('validate_prono');

        // On supprime les classes pr√©c√©dentes pour repartir √† chaque fois sur de bonnes bases
        validate_prono.classList.remove('gender_girl', 'gender_boy', 'no_gender');
        document.getElementById('btn_girl').classList.remove('btn_selected');
        document.getElementById('btn_boy').classList.remove('btn_selected');

        if (btn_girlClicked) {
            validate_prono.classList.add('gender_girl');
            btn_girl.classList.add('btn_selected');
        } else if (btn_boyClicked) {
            validate_prono.classList.add('gender_boy');
            btn_boy.classList.add('btn_selected');
        } else {
            validate_prono.classList.add('no_gender');
        }
    }

    document.getElementById('btn_girl').addEventListener('click', function() {
        document.getElementById('btn_girl').dataset.clicked = 'true';
        document.getElementById('btn_boy').dataset.clicked = 'false';
        updateButtonClass();
    });

    document.getElementById('btn_boy').addEventListener('click', function() {
        document.getElementById('btn_boy').dataset.clicked = 'true';
        document.getElementById('btn_girl').dataset.clicked = 'false';
        updateButtonClass();
    });
    }
        // Mettre √† jour la valeur du champ de formulaire cach√© afin d'envoyer la bonne info du sexe une fois le prono valid√©
    function selectGender(gender) {
        document.getElementById('selectedGender').value = gender;
    }

    // Mettre √† jour la valeur de d√©part du curseur pour le poids et la taille
    function updateWeightValue(value) {
        document.getElementById("weightValue").textContent = value;
    }
    function updateHeightValue(value) {
        document.getElementById("heightValue").textContent = value;
    }
</script>
    

{% endblock %}




<!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
        var btn_the_answers = document.getElementById('btn_my_final_answers');
        var gender_choice = "{{ prono_sex_btn }}";

        if (btn_the_answers) {
            btn_the_answers.classList.remove('gender_girl', 'gender_boy');

            if (gender_choice === "Fille") {
                btn_the_answers.classList.add("gender_girl");
            } else {
                btn_the_answers.classList.add("gender_boy");
            }
        }
    });
</script> -->